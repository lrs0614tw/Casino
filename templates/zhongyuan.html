<!DOCTYPE html> {% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>中元buy黑松 平安好運勢</title>
    <link rel="stylesheet" href="{% static 'css/zhongyuan.css' %}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        $(document).ready(function() {
            $.ajaxSetup({
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
            })
        });
    </script>
</head>

<body>
    <div class="background">
        <div class="cintro">
            <div id="x"></div>
        </div>
        <div class='cbg'>
            <div id="putable"></div>
            <div id="ghost1"></div>
            <div id="ghost2"></div>
            <div class="gongpingText"></div>
            <div class=" type ">
                <div class="drinks"></div>
                <div class="foods"></div>
                <div class="tools"></div>
            </div>
            <div class="gongpingColumn">
                <div class="gongpingRow">
                    <div id="gongping0" class="gongpingbg" ontouchstart="createping(0)"></div>
                    <div id="gongping1" class="gongpingbg" ontouchstart="createping(1)"></div>
                    <div id="gongping2" class="gongpingbg" ontouchstart="createping(2)"></div>
                </div>
                <div class="gongpingRow">
                    <div id="gongping3" class="gongpingbg" ontouchstart="createping(3)"></div>
                    <div id="gongping4" class="gongpingbg" ontouchstart="createping(4)"></div>
                    <div id="gongping5" class="gongpingbg" ontouchstart="createping(5)"></div>
                </div>
            </div>
            <div id="finish">
            </div>
            <div id="trash"></div>
        </div>
    </div>
    <script>
        function xOn() {
            document.getElementsByClassName("cintro")[0].style.display = 'none'
        }
        document.querySelector("#x").addEventListener("click", xOn)
        var drinksList = ["沙士", "茶花", "C&C", "FIN", "茶尋味", "韋恩咖啡"];
        var foodsList = ["蘋果", "橘子", "哈密瓜", "三層肉", "魚", "雞"];
        var toolsList = ["香爐", "紙錢", "酒", "臉盆", "飯", "中元旗子"];
        var nowList = drinksList;
        changeThing(nowList);

        function changeThing(nowList) {
            for (var i = 0; i < 6; i++) {
                var thing = nowList[i].toString();
                var imgUrl = "url( {% static 'img/pudu/gongpingBg/thing.png' %}) no-repeat";
                var imgreUrl = imgUrl.replace('thing', thing)
                var gongpingIndex = document.getElementById("gongping" + i.toString())
                gongpingIndex.style.background = imgreUrl
                gongpingIndex.style.backgroundSize = "contain";
            }
        }

        function drinksOn() {
            nowList = drinksList;
            changeThing(nowList);
        }

        function foodsOn() {
            nowList = foodsList;
            changeThing(nowList);
        }

        function toolsOn() {
            nowList = toolsList;
            changeThing(nowList);
        }
        document.querySelector(".drinks").addEventListener("click", drinksOn)
        document.querySelector(".foods").addEventListener("click", foodsOn)
        document.querySelector(".tools").addEventListener("click", toolsOn)
        var zIndexNow = 2;
        var count = 0
        var pingList = []
        var pingIsDownList = []
        let mouseX = 0
        let mouseY = 0
        let offsetX = 0
        let offsetY = 0
        var topElement = ''

        function createping(i) {
            var putable = document.getElementById("putable")
            var newelement = document.createElement("div")
            var imgUrl = "url( {% static 'img/pudu/gongping/thing.png' %}) no-repeat";
            var imgreUrl = imgUrl.replace('thing', nowList[i])
            newelement.style.background = imgreUrl
            newelement.style.backgroundSize = "contain";
            switch (i) {
                case 0:
                    newelement.style.left = "74px"
                    newelement.style.top = "993px"
                    break;
                case 1:
                    newelement.style.left = "324px"
                    newelement.style.top = "993px"
                    break;
                case 2:
                    newelement.style.left = "574px"
                    newelement.style.top = "993px"
                    break;
                case 3:
                    newelement.style.left = "74px"
                    newelement.style.top = "1167px"
                    break;
                case 4:
                    newelement.style.left = "324px"
                    newelement.style.top = "1167px"
                    break;
                case 5:
                    newelement.style.left = "574px"
                    newelement.style.top = "1167px"
                    break;


            }
            newelement.style.width = "200px";
            newelement.style.height = "200px";
            newelement.style.position = "absolute";

            newelement.style.zIndex = zIndexNow;

            var id = "#gongPingCount" + count.toString();
            newelement.id = "gongPingCount" + count.toString()
            newelement.onclick = function() {
                topElement = id;
            }
            putable.appendChild(newelement);
            zIndexNow = zIndexNow + 1
            count = count + 1
            var cont = $(id);
            var contW = $(id).width();
            var contH = $(id).height();
            var startX, startY, sX, sY, moveX, moveY;
            var winW = $(window).width();
            var winH = $(window).height();
            cont.on({ //绑定事件
                touchstart: function(e) {
                    startX = e.originalEvent.targetTouches[0].pageX; //获取点击点的X坐标
                    startY = e.originalEvent.targetTouches[0].pageY; //获取点击点的Y坐标
                    sX = $(this).offset().left; //相对于当前窗口X轴的偏移量
                    sY = $(this).offset().top; //相对于当前窗口Y轴的偏移量
                    leftX = startX - sX; //鼠标所能移动的最左端是当前鼠标距div左边距的位置
                    rightX = winW - contW + leftX; //鼠标所能移动的最右端是当前窗口距离减去鼠标距div最右端位置
                    topY = startY - sY; //鼠标所能移动最上端是当前鼠标距div上边距的位置
                    bottomY = winH - contH + topY; //鼠标所能移动最下端是当前窗口距离减去鼠标距div最下端位置
                    $(this).css({
                        "z-index": zIndexNow + 1
                    })
                    zIndexNow = zIndexNow + 1
                },
                touchmove: function(e) {
                    e.preventDefault();
                    moveX = e.originalEvent.targetTouches[0].pageX; //移动过程中X轴的坐标
                    moveY = e.originalEvent.targetTouches[0].pageY; //移动过程中Y轴的坐标
                    if (moveX < leftX) {
                        moveX = leftX;
                    }
                    if (moveX > (rightX + 50)) {
                        moveX = rightX + 50;
                    }
                    if (moveY < topY) {
                        moveY = topY;
                    }
                    if (moveY > bottomY) {
                        moveY = bottomY;
                    }
                    $(this).css({
                        "left": moveX + sX - startX - contW / 2,
                        "top": moveY + sY - startY - contH,
                    })
                    if (moveX > 840 && moveY > 1488) {
                        $(this).css({
                            "display": "none",
                        })
                    }
                },

            })


        }



        function createImg() {
            html2canvas(document.querySelector("#putable")).then(function(canvas) {
                a = document.createElement('a');
                a.href = canvas.toDataURL("image/jpeg", 5).replace("image/jpeg", "image/octet-stream");
                a.download = 'image.jpg';
                a.click();
                /*var dataURL = canvas.toDataURL('image/png', 1.0);
                console.log(dataURL)
                window.location.replace('./zhongyuantest?durl=' + dataURL);*/
            });
        }
        document.querySelector("#finish").addEventListener("click", createImg)
    </script>
</body>

</html>